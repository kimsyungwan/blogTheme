import{qs as t,qsa as e,loadHTML as n,setVar as a}from"./util.js";const i=(()=>{let i=null,s=!1,o=new Set,r=null,c=-1,d=0,l="";const f=new Map,u={active:!1,startY:0,startX:0,pullY:0,threshold:64};let p=.5,m=160,h=10,v=1.2,g=16;const b=new Set,w=new Set,y=new Map;let L=0,E=!1,k=!1,A=!1,N=14,x=0;const M=(t="")=>t.replace(/[^a-zA-Z0-9_-]/g,"-"),T=t=>`view-${M(t)}`,$=t=>`app-${M(t)}`,S=t=>(i.tabs||[]).findIndex(e=>e.page===t);function C(){try{const t=[i?.defaultTab,i?.defaultTabPage,i?.mainTab,i?.mainTabPage].filter(t=>"string"==typeof t&&t.trim()),e=t.length?String(t[0]).trim():"";if(e){const t=(i.tabs||[]).find(t=>t.page===e);if(t)return t.page;const n=(i.tabs||[]).find(t=>t.id===e);if(n)return n.page}}catch(t){}return i?.tabs?.[0]?.page||"home"}function H(e){const n=C();!function(e){try{const n=t("#appbar-brand"),a=t("#appbar-title");n&&(n.style.display=e?"":"none",n.setAttribute("aria-hidden",e?"false":"true")),a&&(a.style.display=e?"none":"")}catch(t){}}(!!e&&e===n)}const R=()=>{const n=e(".dynamic-view.active");return n.length?n[n.length-1]:t(".view.active")};function B(){let t=0;return e(".dynamic-view").forEach(e=>{const n=function(t){if(!t)return 0;let e=0;const n=t.style?.zIndex;if(n){const t=parseInt(n,10);Number.isNaN(t)||(e=t)}if(!e&&"undefined"!=typeof window&&window.getComputedStyle){const n=window.getComputedStyle(t),a=parseInt(n.zIndex||"0",10);Number.isNaN(a)||(e=a)}return Number.isNaN(e)?0:e}(e);Number.isNaN(n)||(t=Math.max(t,n))}),t}function _(e){const n=t("#tabbar");n&&n.classList.toggle("hide",!!e)}function D(){const e=t("#dynamic-view-backdrop");if(!e)return;const n=!!t(".dynamic-view.active"),a=!!t('.dynamic-view[data-closing="1"], .dynamic-view.closing'),i=n||a;if(e.classList.toggle("show",i),i){const t=B(),n=Math.max(151,t),a=Math.max(149,n-1);e.style.zIndex=String(a)}else e.style.zIndex=String(149)}function P(){const e=t("#dynamic-view-backdrop");e?.classList.add("show")}function j(){t("#dynamic-loading")?.classList.add("show")}function q(){t("#dynamic-loading")?.classList.remove("show")}function I(t){try{if(/<body[\s\S]*?>[\s\S]*<\/body>/i.test(t)){const e=(new DOMParser).parseFromString(t,"text/html");return e?.body?.innerHTML||t}return t}catch(e){return t}}function Y(t){const n=document.head||document.documentElement;e('link[rel="stylesheet"]',t).forEach(t=>{if(t.hasAttribute("data-spa-ignore"))return void t.remove();const e=t.getAttribute("data-once")||t.getAttribute("href");if(e&&w.has(e))return void t.remove();const a=document.createElement("link");Array.from(t.attributes).forEach(t=>a.setAttribute(t.name,t.value)),n.appendChild(a),e&&w.add(e),t.remove()}),e("style",t).forEach(t=>{if(t.hasAttribute("data-spa-ignore"))return void t.remove();const e=t.getAttribute("data-once"),a=e||(t.textContent?`inline:${function(t){try{let e=5381;for(let n=0;n<t.length;n++)e=(e<<5)+e^t.charCodeAt(n);return String(e>>>0)}catch(t){return String(Date.now())}}(t.textContent)}`:"inline:empty");if(e){if(w.has(a))return void t.remove();const e=document.createElement("style");Array.from(t.attributes).forEach(t=>{"data-once"!==t.name&&e.setAttribute(t.name,t.value)}),e.textContent=t.textContent,n.appendChild(e),w.add(a),t.remove()}})}async function O(t,n="mobile"){const a=e('[data-include]:not([data-include-processed="1"])',t);a.length&&await Promise.all(a.map(async t=>{try{const e=(t.getAttribute("data-include-when")||"both").toLowerCase();if(!("mobile"===n?"mobile"===e||"both"===e:"web"===e||"both"===e))return void t.setAttribute("data-include-processed","1");let a=t.getAttribute("data-include")||"";if(!a)return void t.setAttribute("data-include-processed","1");try{if(!/^https?:|^\//i.test(a)){const t=l||location.href;a=new URL(a,t).href}}catch(t){}const i="once"===(t.getAttribute("data-include-cache")||"").toLowerCase();let s=i&&y.has(a)?y.get(a):"";if(!s){const e=await fetch(a,{credentials:"same-origin"});if(!e.ok)return void t.setAttribute("data-include-processed","1");s=await e.text(),i&&y.set(a,s)}let o=null;const r=t.getAttribute("data-props");if(r)try{o=JSON.parse(r)}catch(t){o=null}const c=function(t,e){if(!e||"object"!=typeof e)return t;try{return t.replace(/\$\{(\w+)\}/g,(t,n)=>n in e?String(e[n]):"")}catch(e){return t}}(s,o);t.innerHTML=c,await O(t,n),Y(t),st(t)}catch(t){}finally{t.setAttribute("data-include-processed","1")}}))}function U(){e(".dynamic-view.active").forEach(t=>{t.dataset.closing="1",t.classList.add("closing");const e=n=>{if(n.target===t){t.removeEventListener("transitionend",e),delete t.dataset.closing,t.classList.remove("closing");try{t.remove()}catch(t){}D(),F(1)}};t.addEventListener("transitionend",e),t.getBoundingClientRect()}),P(),D()}function F(n=1){const a=t("#views");if(!a)return;const i=e('.dynamic-view:not([data-used="1"])',a);let s=Math.max(0,n-i.length);for(;s-- >0;){const t=document.createElement("main");t.className="view dynamic-view",t.dataset.used="0",t.dataset.filledBefore="0";const e=document.createElement("header");e.className="appbar appheader",e.innerHTML='\n        <button class="btn-dv-back" aria-label="back" onclick="(window.goBackWithAnimation ? window.goBackWithAnimation() : history.back())">←</button>\n        <div class="title dv-title">App</div>\n      ';const n=e.querySelector(".btn-dv-back");n?.addEventListener("click",()=>{if(history.length>1)window.__programmaticBack=!0,history.back();else{t.dataset.closing="1",t.classList.add("closing");const e=n=>{if(n.target===t){t.removeEventListener("transitionend",e),delete t.dataset.closing,t.classList.remove("closing");try{t.remove()}catch(t){}D(),F(1)}};t.addEventListener("transitionend",e),t.getBoundingClientRect(),P(),D()}}),(async()=>{if(l)try{const t=new URL("components/appheader.html",l).href,n=await fetch(t,{credentials:"same-origin"});if(n.ok){const t=await n.text();t&&t.trim()&&(e.innerHTML=t)}}catch(t){}})();const i=document.createElement("div");i.className="page",t.appendChild(e),t.appendChild(i),a.appendChild(t)}}function W(t,e,n="forward"){if(e&&t!==e){if(t){const n=e.classList.contains("dynamic-view"),a=t.classList.contains("dynamic-view");if(!a&&n)P();else if(a&&n)P();else if(a&&!n){t.dataset.closing="1",t.classList.add("closing");const e=n=>{n.target===t&&(t.removeEventListener("transitionend",e),delete t.dataset.closing,t.classList.remove("closing"),t.classList.remove("active"),D())};t.addEventListener("transitionend",e),t.getBoundingClientRect(),P(),D()}else{t.classList.remove("active");const e=n=>{n.target===t&&t.removeEventListener("transitionend",e)};t.addEventListener("transitionend",e)}}e.classList.contains("dynamic-view")?(e.classList.add("active"),P()):(e.classList.add("active"),e.getBoundingClientRect()),r=e,D()}}function X(){const t=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(t)?"android":/iPad|iPhone|iPod|iOS/i.test(t)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?"ios":"desktop"}function z(){const t=navigator.userAgent||"",e=/iPhone|iPad|iPod|iOS/i.test(t)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,n=/Safari/i.test(t)&&!/CriOS|FxiOS|EdgiOS/i.test(t),a=!(!window.navigator||!("standalone"in window.navigator))&&!0===window.navigator.standalone;return e&&!n&&!a}function Z(){const e=t("#splash-overlay");if(!e)return;e.classList.remove("show"),e.classList.add("hide");const n=()=>{try{e.remove()}catch(t){}s&&async function(){if(!s||E)return!1;try{if(document.querySelector('meta[name="hybrid:disable-onboarding"]'))return!1}catch(t){}let e="";if(l)try{const t=new URL("components/onboarding.html",l).href,n=await fetch(t,{credentials:"same-origin"});n.ok&&(e=await n.text())}catch(t){}if(!e||!e.trim())return!1;let n=t("#onboarding-overlay");return n||(n=document.createElement("div"),n.id="onboarding-overlay",n.className="onboarding-overlay",document.body.appendChild(n)),n.innerHTML=e,requestAnimationFrame(()=>n?.classList.add("show")),E=!0,!0}().then(t=>{t||G()}).catch(()=>{G()})};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,800)}async function J(){if(!s)return;const e=t(".appbar");if(e&&l)try{const t=new URL("components/appbar.html",l).href,n=await fetch(t,{credentials:"same-origin"});if(!n.ok)return;const a=await n.text();a&&a.trim()&&(e.innerHTML=a)}catch(t){}}function V(){const e=t("#onboarding-overlay");if(!e)return;e.classList.remove("show"),e.classList.add("hide");const n=()=>{try{e.remove()}catch(t){}G()};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,800)}async function G(){if(!s||k)return!1;try{if(document.querySelector('meta[name="hybrid:disable-intro"]'))return!1}catch(t){}let e="";if(l)try{const t=new URL("components/intro.html",l).href,n=await fetch(t,{credentials:"same-origin"});n.ok&&(e=await n.text())}catch(t){}if(!e||!e.trim())return!1;let n=t("#intro-overlay");return n||(n=document.createElement("div"),n.id="intro-overlay",n.className="intro-overlay",document.body.appendChild(n)),n.innerHTML=e,requestAnimationFrame(()=>n?.classList.add("show")),k=!0,!0}function K(){const e=t("#intro-overlay");if(!e)return;e.classList.remove("show"),e.classList.add("hide");const n=()=>{try{e.remove()}catch(t){}};e.addEventListener("transitionend",n,{once:!0}),setTimeout(n,800)}async function Q(){const e=t("#offcanvas-left"),n=t("#offcanvas-right");if(!l)return;const a=async t=>{try{const e=await fetch(t,{credentials:"same-origin"});return e.ok?await e.text():null}catch(t){return null}};if(e){const t=new URL("components/offcanvas-left.html",l).href,n=await a(t);"string"==typeof n&&n.trim()&&(e.innerHTML=n)}if(n){const t=new URL("components/offcanvas-right.html",l).href,e=await a(t);"string"==typeof e&&e.trim()&&(n.innerHTML=e)}}async function tt(){if(!s)return;const e=t("#tabbar");if(e&&l)try{const t=new URL("components/tabbar.html",l).href,n=await fetch(t,{credentials:"same-origin"});if(!n.ok)return;const a=await n.text();a&&a.trim()&&(e.innerHTML=a)}catch(t){}}function et(t,e){if(!t)return;const n=t.querySelector(".appheader");if(!n)return;const a=n.querySelector(".title")||n.querySelector("[data-title]")||n.querySelector(".dv-title");a&&(a.textContent=e)}function nt(n,{updateHash:a=!1}={}){const s=t("#views"),o=t(".view.active");if(o&&!o.classList.contains("dynamic-view")){const t=(i.tabs||[]).find(t=>T(t.page)===o.id)?.page;t&&s&&f.set(t,s.scrollTop||0)}const r=(e=>t(`#${CSS.escape(T(e))}`))(n);if(!r)return;const d=R(),l=S(n);let u="backward";if(d&&d.id){const t=(i.tabs||[]).find(t=>T(t.page)===d.id)?.page,e="string"==typeof t?S(t):-1;-1!==e&&-1!==l?u=l>e?"forward":"backward":d.classList.contains("dynamic-view")&&(u="backward")}else-1!==c&&-1!==l&&(u=l>c?"forward":"backward");W(d,r,"forward"===u?"forward":"backward"),e(".view:not(.dynamic-view)").forEach(t=>{t.classList.toggle("active",t===r)}),function(n){const a=t("#tabbar");a&&e("a",a).forEach(t=>{const e=t.getAttribute("href").replace("#","");t.classList.toggle("active",e===n)})}(n),H(n);const p=(i.routes||[]).find(t=>t.path===n);if(p?.title&&function(e){const n=t("#appbar-title");n&&(n.textContent=e),document.title=e}(p.title),a&&location.hash.replace("#","")!==n&&history.pushState(null,"",`#${n}`),s){const t=f.get(n)||0;s.scrollTop=t}c=l}function at(a){const o=(i.routes||[]).find(t=>t.path===a),r=/^(?:#)?(?:\.\/)?pages\/.+\.html(?:\?.*)?$/i.test(a)||/^\/?pages\/.+\.html(?:\?.*)?$/i.test(a),c=!o&&r;if(!o&&!c)return;const l=(t=>e(".dynamic-view").find(e=>e.dataset.path===t&&"1"===e.dataset.used)||null)(a);if(l){const t=R();if(t&&t!==l){if(t.classList.contains("dynamic-view")){const e="ios"===X(),n=z(),a=e&&!n&&Date.now()-d<=800,i=!!window.__programmaticBack;if(a&&!i){try{t.remove()}catch(t){}D(),F(1)}else{t.dataset.closing="1",t.classList.add("closing");const e=n=>{if(n.target===t){t.removeEventListener("transitionend",e),delete t.dataset.closing,t.classList.remove("closing");try{t.remove()}catch(t){}D(),F(1)}};t.addEventListener("transitionend",e),t.getBoundingClientRect(),P(),D()}}l.classList.add("active"),D(),et(l,o?.title||((l.dataset.path||"").split("/").pop()||"").replace(/\.html?$/i,"").replace(/[-_]/g," ").trim()||"App"),window.scrollTo(0,0)}return}const f=function(){F(1);const e=t("#views");return t('.dynamic-view:not([data-used="1"])',e)}(),u=t(".page",f),[p,m]=String(a).split("?"),h=c?(()=>{let t=p.replace(/^#/,"");return t=t.replace(/^\//,""),t.startsWith("./")||(t=`./${t}`),t+(m?`?${m}`:"")})():`./pages/${o.file}${m?`?${m}`:""}`,v=(h.split("/").pop()||"").replace(/\.html?$/i,"").replace(/[-_]/g," ").trim()||"App";f.dataset.used="1",f.dataset.path=a,et(f,o&&o.title||v);const g=R();f.style.zIndex=String(function(){const t=B();return Math.max(150,t)+1}()),W(g,f,"forward"),j(),n(h).then(t=>{if(location.hash.replace(/^#/,"")!==a){f.dataset.closing="1",f.classList.add("closing");const t=e=>{if(e.target===f){f.removeEventListener("transitionend",t),delete f.dataset.closing,f.classList.remove("closing");try{f.remove()}catch(t){}D(),F(1)}};return f.addEventListener("transitionend",t),f.getBoundingClientRect(),P(),void D()}u.innerHTML=I(t),Y(u),O(u,s?"mobile":"web"),st(u),f.dataset.filledBefore="1",window.scrollTo(0,0),F(1),function(){const t=Array.from(e(".dynamic-view"));t.length<=6||t.filter(t=>!t.classList.contains("active")).slice(0,t.length-6).forEach(t=>t.remove())}()}).catch(()=>{}).finally(()=>{q()})}function it(){const n=C(),a=location.hash.replace(/^#/,""),s=!!t(".view.active:not(.dynamic-view)"),r=a||(s?"":n),c=!!r&&o.has(r);if(!c){const e=t("#views"),n=t(".view.active");if(n&&!n.classList.contains("dynamic-view")){const t=(i.tabs||[]).find(t=>T(t.page)===n.id)?.page;t&&e&&f.set(t,e.scrollTop||0)}}const l="ios"===X(),u=z(),p=l&&!u&&Date.now()-d<=800;if(r)if(c){const t=!!window.__programmaticBack;p&&!t?(e(".dynamic-view").forEach(t=>{try{t.remove()}catch(t){}}),D(),F(1)):U(),nt(r)}else at(r);else{const n=!!window.__programmaticBack;p&&!n?function(){const t=(()=>{const t=e(".dynamic-view.active");return t.length?t[t.length-1]:null})();if(!t)return!1;try{t.remove()}catch(t){}D(),F(1)}():U(),window.__programmaticBack=!1;const a=t(".view.active:not(.dynamic-view)"),s=(i.tabs||[]).find(t=>T(t.page)===a?.id)?.page;H(s||"")}d=0,window.__programmaticBack=!1}function st(t){e("script",t).forEach(t=>{if(t.hasAttribute("data-spa-ignore"))return;const e=t.getAttribute("data-once")||t.getAttribute("src");if(e&&b.has(e))return;const n=document.createElement("script"),a=t.getAttribute("src"),i=t.getAttribute("type");i&&(n.type=i),a?n.src=a:n.textContent=t.textContent,t.defer&&(n.defer=!0),t.async&&(n.async=!0),e&&b.add(e),document.body.appendChild(n),n.remove()})}return{initApp:async function(r="./appConfig.json"){i=await fetch(r).then(t=>t.json());try{const t=i?.pullToRefresh||i?.ptr||{};if(t&&"object"==typeof t){const e=Number(t.threshold),n=Number(t.damping),a=Number(t.maxPull),i=Number(t.startSlop??t.activationSlop),s=Number(t.directionLockRatio??t.lockRatio),o=Number(t.ignoreEdgeX??t.edgeIgnoreX);!Number.isNaN(e)&&e>=0&&(u.threshold=e),!Number.isNaN(n)&&n>0&&n<=1&&(p=n),!Number.isNaN(a)&&a>=40&&(m=a),!Number.isNaN(i)&&i>=0&&(h=i),!Number.isNaN(s)&&s>=1&&(v=s),!Number.isNaN(o)&&o>=0&&(g=o)}}catch(t){}try{const t=i?.tabbar||{};A=!0===i?.tabbarAutoHide||!0===t.autoHide;const e=Number(i?.tabbarAutoHideThreshold??t.hideThreshold);!Number.isNaN(e)&&e>=4&&(N=e)}catch(t){}try{const t=new URL(r,location.href);l=t.href.replace(/[^/]*$/,"")}catch(t){l=location.href.replace(/[^/]*$/,"")}s=!0===i?.theme?.isMobile||function(){const t=X();return"android"===t||"ios"===t}();const f=!0===i?.splashForce;await async function(e=!1){if(!s&&!e)return;let n="";if(l)try{const t=new URL("components/splash.html",l).href,e=await fetch(t,{credentials:"same-origin"});e.ok&&(n=await e.text())}catch(t){}if(!n&&!e)return;n||(n='<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#fff;z-index:10000"><div class="spinner" style="width:36px;height:36px;border-radius:50%;border:3px solid rgba(0,0,0,.15);border-top-color:rgba(0,0,0,.6);animation:spin .8s linear infinite"></div></div>');let a=t("#splash-overlay");a||(a=document.createElement("div"),a.id="splash-overlay",a.className="splash-overlay",document.body.appendChild(a)),a.innerHTML=n,requestAnimationFrame(()=>a?.classList.add("show")),L=Date.now()}(f),function(t){t.primaryColor&&a("--primary-color",t.primaryColor),t.bg&&a("--bg",t.bg),t.text&&a("--text",t.text),t.font&&(document.documentElement.style.fontFamily=t.font)}(i.theme||{}),function(){const n=t("#root")||document.body;s&&!t(".appbar",n)&&n.insertAdjacentHTML("afterbegin",'\n        <header class="appbar">\n          <button id="btn-menu-left" aria-label="open left menu">☰</button>\n          <div class="title" id="appbar-title">App</div>\n          <button id="btn-menu-right" aria-label="open right menu">☰</button>\n        </header>\n      '),t("#views",n)||n.insertAdjacentHTML("beforeend",'<section class="views" id="views"></section>');const a=t("#views");(i.tabs||[]).forEach(e=>{t(`#${CSS.escape(T(e.page))}`,a)||a.insertAdjacentHTML("beforeend",`\n          <main class="view" id="${T(e.page)}" aria-labelledby="tab-${e.id}">\n            <div class="page" id="${$(e.page)}"></div>\n          </main>\n        `)}),s&&!t(".tabbar",n)&&n.insertAdjacentHTML("beforeend",'<nav class="tabbar" id="tabbar"></nav>'),t("#offcanvas-right",n)||n.insertAdjacentHTML("beforeend",'\n        <div class="offcanvas right" id="offcanvas-right">\n          <div style="padding:16px">\n            <h3>Right Menu</h3>\n            <p>Put extra menu items here.</p>\n          </div>\n        </div>\n        <div class="offcanvas-backdrop" id="offcanvas-backdrop"></div>\n      '),t("#offcanvas-left",n)||n.insertAdjacentHTML("beforeend",'\n        <div class="offcanvas left" id="offcanvas-left">\n          <div style="padding:16px">\n            <h3>Left Menu</h3>\n            <p>Additional items here.</p>\n          </div>\n        </div>\n      ');const o=document.documentElement;o.classList.toggle("mobile-mode",s),o.classList.toggle("desktop-mode",!s),o.classList.remove("android","ios");const r=X();if(!s||"android"!==r&&"ios"!==r||o.classList.add(r),function(){if(!t("#dynamic-view-backdrop")){const t=document.createElement("div");t.id="dynamic-view-backdrop",t.className="dynamic-view-backdrop",document.body.appendChild(t)}}(),F(1),D(),function(){if(!t("#dynamic-loading")){const t=document.createElement("div");t.id="dynamic-loading",t.className="dynamic-loading",t.innerHTML='<div class="spinner" aria-label="Loading" role="status"></div>',document.body.appendChild(t)}}(),function(){const e=t("#views");if(e&&!t("#pull-to-refresh",e)){const t=document.createElement("div");t.id="pull-to-refresh",t.className="pull-to-refresh",t.innerHTML='<div class="ptr-indicator"><div class="spinner"></div></div>',e.appendChild(t)}}(),!s){const t=C();t&&(e(".view",a).forEach(e=>e.classList.toggle("active",e.id===T(t))),c=Math.max(0,S(t)),H(t))}}(),await Promise.all([J(),Q(),tt()]),function(e){const n=t("#tabbar");if(!n)return document.documentElement.classList.add("no-tabbar"),void(o=new Set);document.documentElement.classList.remove("no-tabbar"),n.style.display="",n.hasChildNodes()||(n.innerHTML=e.map(t=>`\n        <a id="tab-${t.id}" href="#${t.page}" data-id="${t.id}" aria-label="${t.label}">\n          <div>${t.icon?`<span class="icon">${t.icon}</span>`:""}</div>\n          <span>${t.label}</span>\n        </a>\n      `).join("")),o=new Set(e.map(t=>t.page)),n.addEventListener("click",e=>{const n=e.target.closest('a[href^="#"], [data-tab]');if(!n)return;e.preventDefault();const a=n.getAttribute("href")||"",s=(a.startsWith("#")?a.slice(1):"")||n.getAttribute("data-tab"),o=t(".view.active"),r=o&&!o.classList.contains("dynamic-view")?(i.tabs||[]).find(t=>T(t.page)===o.id)?.page:null;if(r&&r===s){const e=t("#views");return void(e&&e.scrollTo({top:0,behavior:"smooth"}))}nt(s,{updateHash:!1})})}(i.tabs||[]),function(){const e=t("#btn-menu-left")||t('[data-open-offcanvas="left"]'),n=t("#btn-menu-right")||t('[data-open-offcanvas="right"]'),a=t("#offcanvas-right"),i=t("#offcanvas-left"),s=t("#offcanvas-backdrop");function o(t="right"){"left"===t?i?.classList.add("open"):a?.classList.add("open"),s?.classList.add("show")}function r(){a?.classList.remove("open"),i?.classList.remove("open"),s?.classList.remove("show")}e?.addEventListener("click",()=>o("left")),n?.addEventListener("click",()=>o("right")),s?.addEventListener("click",r),document.addEventListener("keydown",t=>{"Escape"===t.key&&r()});const c=t=>{t.target.closest("a")&&r()};i?.addEventListener("click",c),a?.addEventListener("click",c),document.addEventListener("click",t=>{const e=t.target.closest("[data-open-offcanvas], .open-offcanvas-left, .open-offcanvas-right, [data-close-offcanvas], .offcanvas-close");if(e){if(e.matches("[data-open-offcanvas], .open-offcanvas-left, .open-offcanvas-right"))return t.preventDefault(),void o(e.getAttribute("data-open-offcanvas")||(e.classList.contains("open-offcanvas-left")?"left":(e.classList.contains("open-offcanvas-right"),"right")));e.matches("[data-close-offcanvas], .offcanvas-close")&&(t.preventDefault(),r())}}),window.openOffcanvas=o,window.closeOffcanvas=r}(),s&&function(){if(!s||!A)return;const e=t("#views"),n=t("#tabbar");if(!e||!n)return;x=e.scrollTop||0;let a=!1;e.addEventListener("scroll",()=>{a||(a=!0,requestAnimationFrame(()=>{const t=e.scrollTop||0,n=t-x;t<=0?_(!1):Math.abs(n)>=N&&(_(n>0),x=t),a=!1}))},{passive:!0})}(),await async function(){const e=new Map((i.routes||[]).map(t=>[t.path,t]));for(const a of i.tabs||[]){const i=e.get(a.page),o=t(`#${CSS.escape($(a.page))}`);if(i&&o&&"1"!==o.dataset.loaded)try{const t=await n(`./pages/${i.file}${location.search||""}`);o.innerHTML=t,O(o,s?"mobile":"web"),st(o),o.dataset.loaded="1"}catch(t){o.innerHTML=`<p style="color:#c00">Failed to load ${i.file}</p>`}}}(),window.addEventListener("hashchange",it),it(),s&&document.addEventListener("click",t=>{const e=t.target.closest("a");if(!e)return;if(e.classList&&e.classList.contains("popup"))return;if(e.matches&&e.matches("a.popup,[data-popup]"))return;if(e.closest("#tabbar"))return;const n=e.getAttribute("href")||"";if(n.startsWith("#"))return t.preventDefault(),void(location.hash=n);if(/^(?:https?:|mailto:|tel:|javascript:)/i.test(n))return;let a=n.trim();return a.startsWith("/")&&(a=a.slice(1)),a.startsWith("./")&&(a=a.slice(2)),/^pages\/.+\.html?(?:\?.*)?$/i.test(a)||!/\.|\//.test(a)||/^(?:[a-zA-Z0-9_-]+\/.+)$/.test(a)?(t.preventDefault(),void(location.hash=`#${a}`)):void 0}),s&&function(){const e=t("#views");if(!e)return;const a=t=>t.touches?t.touches[0].clientY:t.clientY,s=t=>t.touches?t.touches[0].clientX:t.clientX,o=()=>R(),r=t("#pull-to-refresh",e),c=t=>{if(!(e.scrollTop>0)){try{const e="ios"===X(),n=s(t)||0;if(e&&(n<=g||n<=16))return}catch(t){}u.active=!0,u.startY=a(t),u.startX=s(t)||0,u.pullY=0}},d=t=>{if(!u.active)return;const e=a(t)-u.startY;if(Math.abs((s(t)||0)-(u.startX||0))*v>Math.max(e,0))return;if(e<=0)return;const n=Math.max(0,e-h);if(n<=0)return;u.pullY=Math.min(n,m);const i=u.pullY*p;t.preventDefault();const c=o();c&&(c.style.transform=`translateY(${i}px)`),r&&(r.style.height=`${Math.min(i,48)}px`)},l=async()=>{if(!u.active)return;const e=u.pullY>=u.threshold;(()=>{const t=o();t&&(t.style.transform=""),r&&(r.style.height=""),u.active=!1,u.pullY=0})(),e&&await async function(){const e=R(),a=t("#views");if(e&&a){j();try{if(e.classList.contains("dynamic-view")){const a=e.dataset.path||"",s=(i.routes||[]).find(t=>t.path===a),o=/^(?:#)?(?:\.\/)?pages\/.+\.html(?:\?.*)?$/i.test(a)||/^\/?pages\/.+\.html(?:\?.*)?$/i.test(a),r=!s&&o?(()=>{let t=a.replace(/^#/,"");return t=t.replace(/^\//,""),t.startsWith("./")||(t=`./${t}`),t})():`./pages/${s?.file}${location.search||""}`,c=await n(r),d=t(".page",e);d&&(d.innerHTML=I(c),Y(d),st(d))}else{const a=(i.tabs||[]).find(t=>T(t.page)===e.id)?.page,s=(i.routes||[]).find(t=>t.path===a),o=a?t(`#${CSS.escape($(a))}`):null;if(s&&o){const t=await n(`./pages/${s.file}${location.search||""}`);o.innerHTML=I(t),Y(o),st(o),o.dataset.loaded="1"}}}catch(t){}finally{q()}}}()};e.addEventListener("touchstart",c,{passive:!0}),e.addEventListener("touchmove",d,{passive:!1}),e.addEventListener("touchend",l,{passive:!0}),e.addEventListener("pointerdown",c,{passive:!0}),e.addEventListener("pointermove",d,{passive:!1}),e.addEventListener("pointerup",l,{passive:!0})}(),s&&(document.addEventListener("click",t=>{const e=t.target;if(e)return e.closest("[data-close-onboarding], .onboarding-close")?(t.preventDefault(),void V()):e.closest("[data-close-intro], .intro-close")?(t.preventDefault(),void K()):void 0}),window.hideOnboarding=function(){V()},window.hideIntro=K),s&&function(){if("ios"!==X())return;const t=t=>{try{((t.touches?t.touches[0].clientX:t.clientX)||0)<=16&&(d=Date.now())}catch(t){}};document.addEventListener("touchstart",t,{passive:!0}),document.addEventListener("pointerdown",t,{passive:!0})}(),window.goBackWithAnimation=function(){try{window.__programmaticBack=!0}catch(t){}history.back()},s&&function(t){const e=L||Date.now(),n=Math.max(Number(t||0),1200),a=Date.now()-e,i=Math.max(n-a,0);setTimeout(Z,i)}(Math.max(0,Number(i?.splashDelay??200)))}}})();window.Core=i;export default i;